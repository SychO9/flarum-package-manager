(()=>{var a={3:function(a){a.exports=function(){"use strict";var a,t,e=1e3,n=6e4,r=36e5,s=864e5,o=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,i=31536e6,l=2592e6,c=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,u={years:i,months:l,days:s,hours:r,minutes:n,seconds:e,milliseconds:1,weeks:6048e5},m=function(a){return a instanceof b},d=function(a,t,e){return new b(a,e,t.$l)},p=function(a){return t.p(a)+"s"},g=function(a){return a<0},f=function(a){return g(a)?Math.ceil(a):Math.floor(a)},h=function(a){return Math.abs(a)},k=function(a,t){return a?g(a)?{negative:!0,format:""+h(a)+t}:{negative:!1,format:""+a+t}:{negative:!1,format:""}},b=function(){function g(a,t,e){var n=this;if(this.$d={},this.$l=e,void 0===a&&(this.$ms=0,this.parseFromMilliseconds()),t)return d(a*u[p(t)],this);if("number"==typeof a)return this.$ms=a,this.parseFromMilliseconds(),this;if("object"==typeof a)return Object.keys(a).forEach((function(t){n.$d[p(t)]=a[t]})),this.calMilliseconds(),this;if("string"==typeof a){var r=a.match(c);if(r){var s=r.slice(2).map((function(a){return null!=a?Number(a):0}));return this.$d.years=s[0],this.$d.months=s[1],this.$d.weeks=s[2],this.$d.days=s[3],this.$d.hours=s[4],this.$d.minutes=s[5],this.$d.seconds=s[6],this.calMilliseconds(),this}}return this}var h=g.prototype;return h.calMilliseconds=function(){var a=this;this.$ms=Object.keys(this.$d).reduce((function(t,e){return t+(a.$d[e]||0)*u[e]}),0)},h.parseFromMilliseconds=function(){var a=this.$ms;this.$d.years=f(a/i),a%=i,this.$d.months=f(a/l),a%=l,this.$d.days=f(a/s),a%=s,this.$d.hours=f(a/r),a%=r,this.$d.minutes=f(a/n),a%=n,this.$d.seconds=f(a/e),a%=e,this.$d.milliseconds=a},h.toISOString=function(){var a=k(this.$d.years,"Y"),t=k(this.$d.months,"M"),e=+this.$d.days||0;this.$d.weeks&&(e+=7*this.$d.weeks);var n=k(e,"D"),r=k(this.$d.hours,"H"),s=k(this.$d.minutes,"M"),o=this.$d.seconds||0;this.$d.milliseconds&&(o+=this.$d.milliseconds/1e3);var i=k(o,"S"),l=a.negative||t.negative||n.negative||r.negative||s.negative||i.negative,c=r.format||s.format||i.format?"T":"",u=(l?"-":"")+"P"+a.format+t.format+n.format+c+r.format+s.format+i.format;return"P"===u||"-P"===u?"P0D":u},h.toJSON=function(){return this.toISOString()},h.format=function(a){var e=a||"YYYY-MM-DDTHH:mm:ss",n={Y:this.$d.years,YY:t.s(this.$d.years,2,"0"),YYYY:t.s(this.$d.years,4,"0"),M:this.$d.months,MM:t.s(this.$d.months,2,"0"),D:this.$d.days,DD:t.s(this.$d.days,2,"0"),H:this.$d.hours,HH:t.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:t.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:t.s(this.$d.seconds,2,"0"),SSS:t.s(this.$d.milliseconds,3,"0")};return e.replace(o,(function(a,t){return t||String(n[a])}))},h.as=function(a){return this.$ms/u[p(a)]},h.get=function(a){var t=this.$ms,e=p(a);return"milliseconds"===e?t%=1e3:t="weeks"===e?f(t/u[e]):this.$d[e],0===t?0:t},h.add=function(a,t,e){var n;return n=t?a*u[p(t)]:m(a)?a.$ms:d(a,this).$ms,d(this.$ms+n*(e?-1:1),this)},h.subtract=function(a,t){return this.add(a,t,!0)},h.locale=function(a){var t=this.clone();return t.$l=a,t},h.clone=function(){return d(this.$ms,this)},h.humanize=function(t){return a().add(this.$ms,"ms").locale(this.$l).fromNow(!t)},h.milliseconds=function(){return this.get("milliseconds")},h.asMilliseconds=function(){return this.as("milliseconds")},h.seconds=function(){return this.get("seconds")},h.asSeconds=function(){return this.as("seconds")},h.minutes=function(){return this.get("minutes")},h.asMinutes=function(){return this.as("minutes")},h.hours=function(){return this.get("hours")},h.asHours=function(){return this.as("hours")},h.days=function(){return this.get("days")},h.asDays=function(){return this.as("days")},h.weeks=function(){return this.get("weeks")},h.asWeeks=function(){return this.as("weeks")},h.months=function(){return this.get("months")},h.asMonths=function(){return this.as("months")},h.years=function(){return this.get("years")},h.asYears=function(){return this.as("years")},g}();return function(e,n,r){a=r,t=r().$utils(),r.duration=function(a,t){var e=r.locale();return d(a,{$l:e},t)},r.isDuration=m;var s=n.prototype.add,o=n.prototype.subtract;n.prototype.add=function(a,t){return m(a)&&(a=a.asMilliseconds()),s.bind(this)(a,t)},n.prototype.subtract=function(a,t){return m(a)&&(a=a.asMilliseconds()),o.bind(this)(a,t)}}}()}},t={};function e(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return a[n].call(s.exports,s,s.exports,e),s.exports}e.n=a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},e.d=(a,t)=>{for(var n in t)e.o(t,n)&&!e.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:t[n]})},e.o=(a,t)=>Object.prototype.hasOwnProperty.call(a,t),e.r=a=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})};var n={};(()=>{"use strict";e.r(n);const a=flarum.core.compat["common/extend"],t=flarum.core.compat["admin/app"];var r=e.n(t);const s=flarum.core.compat["admin/components/ExtensionPage"];var o=e.n(s);const i=flarum.core.compat["common/components/Button"];var l=e.n(i);const c=flarum.core.compat["admin/components/LoadingModal"];var u=e.n(c);const d=flarum.core.compat["admin/utils/isExtensionEnabled"];var p=e.n(d);function g(a,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,t){return a.__proto__=t,a},g(a,t)}function f(a,t){a.prototype=Object.create(t.prototype),a.prototype.constructor=a,g(a,t)}function h(a,t){if(null==a)return{};var e,n,r={},s=Object.keys(a);for(n=0;n<s.length;n++)e=s[n],t.indexOf(e)>=0||(r[e]=a[e]);return r}const k=flarum.core.compat["common/Component"];var b=e.n(k);const v=flarum.core.compat["common/components/LoadingIndicator"];var y=e.n(v);const _=flarum.core.compat["common/components/Tooltip"];var N=e.n(_);const x=flarum.core.compat["common/helpers/icon"];var M=e.n(x);const w=flarum.core.compat["common/utils/ItemList"];var P=e.n(w);const U=flarum.core.compat["common/utils/extractText"];var B=e.n(U);const S=flarum.core.compat["common/components/Link"];var j=e.n(S);const q=flarum.core.compat["common/utils/classList"];var $=e.n(q),T=["className","type"],C=function(a){function t(){return a.apply(this,arguments)||this}return f(t,a),t.prototype.view=function(a){var t=this.attrs,e=t.className,n=(t.type,h(t,T));return m("span",Object.assign({className:$()(["Label","Label--"+this.attrs.type,e])},n),a.children)},t}(b());const O=flarum.core.compat["common/components/Modal"];var F=e.n(O),L=function(a){function t(){return a.apply(this,arguments)||this}f(t,a);var e=t.prototype;return e.className=function(){return"Modal--large QuickModal"},e.title=function(){return r().translator.trans("flarum-package-manager.admin.sections.queue.operations."+this.attrs.task.operation())},e.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"TaskOutputModal-data"},"failure"===this.attrs.task.status()&&m("div",{className:"Form-group"},m("label",null,r().translator.trans("flarum-package-manager.admin.sections.queue.output_modal.guessed_cause")),m("div",{className:"FormControl TaskOutputModal-data-guessed-cause"},this.attrs.task.guessedCause()&&r().translator.trans("flarum-package-manager.admin.exceptions.guessed_cause."+this.attrs.task.guessedCause())||r().translator.trans("flarum-package-manager.admin.sections.queue.output_modal.cause_unknown"))),m("div",{className:"Form-group"},m("label",null,r().translator.trans("flarum-package-manager.admin.sections.queue.output_modal.command")),m("div",{className:"FormControl TaskOutputModal-data-command"},m("code",null,"$ composer ",this.attrs.task.command()))),m("div",{className:"Form-group"},m("label",null,r().translator.trans("flarum-package-manager.admin.sections.queue.output_modal.output")),m("div",{className:"FormControl TaskOutputModal-data-output"},m("code",null,m("pre",null,this.attrs.task.output()))))))},t}(F()),A=e(3),E=e.n(A),D=function(a){function t(){return a.apply(this,arguments)||this}return f(t,a),t.prototype.view=function(){var a=this;return m("nav",{className:"Pagination UserListPage-gridPagination"},m(l(),{disabled:!this.attrs.list.hasPrev()||r().packageManager.control.isLoading(),title:r().translator.trans("core.admin.users.pagination.back_button"),onclick:function(){return a.attrs.list.prev()},icon:"fas fa-chevron-left",className:"Button Button--icon UserListPage-backBtn"}),m("span",{className:"UserListPage-pageNumber"},r().translator.trans("core.admin.users.pagination.page_counter",{current:this.attrs.list.pageNumber()+1,total:this.attrs.list.getTotalPages()})),m(l(),{disabled:!this.attrs.list.hasNext()||r().packageManager.control.isLoading(),title:r().translator.trans("core.admin.users.pagination.next_button"),onclick:function(){return a.attrs.list.next()},icon:"fas fa-chevron-right",className:"Button Button--icon UserListPage-nextBtn"}))},t}(b()),Y=["label","content"],I=function(a){function t(){return a.apply(this,arguments)||this}f(t,a);var e=t.prototype;return e.oninit=function(t){a.prototype.oninit.call(this,t),r().packageManager.queue.load()},e.view=function(){return m("section",{id:"PackageManager-queueSection",className:"ExtensionPage-permissions PackageManager-queueSection"},m("div",{className:"ExtensionPage-permissions-header PackageManager-queueSection-header"},m("div",{className:"container"},m("h2",{className:"ExtensionTitle"},r().translator.trans("flarum-package-manager.admin.sections.queue.title")),m(l(),{className:"Button Button--icon",icon:"fas fa-sync-alt",onclick:function(){return r().packageManager.queue.load()},"aria-label":r().translator.trans("flarum-package-manager.admin.sections.queue.refresh"),disabled:r().packageManager.control.isLoading()}))),m("div",{className:"container"},this.queueTable()))},e.columns=function(){var a=this,t=new(P());return t.add("operation",{label:B()(r().translator.trans("flarum-package-manager.admin.sections.queue.columns.operation")),content:function(t){return m("div",{className:"PackageManager-queueTable-operation"},m("span",{className:"PackageManager-queueTable-operation-icon"},a.operationIcon(t.operation())),m("span",{className:"PackageManager-queueTable-operation-name"},r().translator.trans("flarum-package-manager.admin.sections.queue.operations."+t.operation())))}},80),t.add("package",{label:B()(r().translator.trans("flarum-package-manager.admin.sections.queue.columns.package")),content:function(a){var t,e=r().data.extensions[null==(t=a.package())?void 0:t.replace(/(\/flarum-|\/flarum-ext-|\/)/g,"-")];return e?m(j(),{className:"PackageManager-queueTable-package",href:r().route("extension",{id:e.id})},m("div",{className:"PackageManager-queueTable-package-icon ExtensionIcon",style:e.icon},!!e.icon&&M()(e.icon.name)),m("div",{className:"PackageManager-queueTable-package-details"},m("span",{className:"PackageManager-queueTable-package-title"},e.extra["flarum-extension"].title),m("span",{className:"PackageManager-queueTable-package-name"},a.package()))):a.package()}},75),t.add("status",{label:B()(r().translator.trans("flarum-package-manager.admin.sections.queue.columns.status")),content:function(a){return m("[",null,m(C,{className:"PackageManager-queueTable-status",type:{running:"neutral",failure:"error",pending:"warning",success:"success"}[a.status()]},r().translator.trans("flarum-package-manager.admin.sections.queue.statuses."+a.status())),["pending","running"].includes(a.status())&&m(y(),{size:"small",display:"inline"}))}},70),t.add("elapsedTime",{label:B()(r().translator.trans("flarum-package-manager.admin.sections.queue.columns.elapsed_time")),content:function(a){return a.startedAt()&&a.finishedAt()?m(N(),{text:dayjs(a.startedAt()).format("LL LTS")+"  "+dayjs(a.finishedAt()).format("LL LTS")},m("span",null,function(a,t){dayjs.extend(E());var e=dayjs(t).diff(a);return dayjs.duration(e).humanize()}(a.startedAt(),a.finishedAt()))):r().translator.trans("flarum-package-manager.admin.sections.queue.task_just_started")}},65),t.add("memoryUsed",{label:B()(r().translator.trans("flarum-package-manager.admin.sections.queue.columns.peak_memory_used")),content:function(a){return m("span",null,a.peakMemoryUsed())}},60),t.add("details",{label:B()(r().translator.trans("flarum-package-manager.admin.sections.queue.columns.details")),content:function(a){return m(l(),{className:"Button Button--icon Table-controls-item",icon:"fas fa-file-alt","aria-label":r().translator.trans("flarum-package-manager.admin.sections.queue.columns.details"),onclick:function(){return r().modal.show(L,{task:a})},disabled:["pending","running"].includes(a.status())})},className:"Table-controls"},55),t},e.queueTable=function(){var a=r().packageManager.queue.getItems();if(!a)return m(y(),null);if(a&&!a.length)return m("h3",{className:"ExtensionPage-subHeader"},r().translator.trans("flarum-package-manager.admin.sections.queue.none"));var t=this.columns();return m("[",null,m("table",{className:"Table PackageManager-queueTable"},m("thead",null,m("tr",null,t.toArray().map((function(a,t){return m("th",{key:t},a.label)})))),m("tbody",null,a.map((function(a,e){return m("tr",{key:e},t.toArray().map((function(t,e){t.label;var n=t.content,r=h(t,Y);return m("td",Object.assign({key:e},r),n(a))})))})))),m(D,{list:r().packageManager.queue}))},e.operationIcon=function(a){return M()({update_check:"fas fa-sync-alt",update_major:"fas fa-play",update_minor:"fas fa-play",update_global:"fas fa-play",extension_install:"fas fa-download",extension_remove:"fas fa-times",extension_update:"fas fa-arrow-alt-circle-up",why_not:"fas fa-exclamation-circle"}[a])},t}(b());const G=flarum.core.compat["common/components/Alert"];var H=e.n(G);const W=flarum.core.compat["common/utils/Stream"];var R=e.n(W),V=function(a){function t(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.call.apply(a,[this].concat(n))||this).packageName=void 0,t}f(t,a);var e=t.prototype;return e.oninit=function(t){a.prototype.oninit.call(this,t),this.packageName=R()("")},e.view=function(){return m("div",{className:"Form-group PackageManager-installer"},m("label",{htmlFor:"install-extension"},r().translator.trans("flarum-package-manager.admin.extensions.install")),m("p",{className:"helpText"},r().translator.trans("flarum-package-manager.admin.extensions.install_help",{extiverse:m("a",{href:"https://extiverse.com"},"extiverse.com"),semantic_link:m("a",{href:"https://devhints.io/semver"}),code:m("code",null)})),m("div",{className:"FormControl-container"},m("input",{className:"FormControl",id:"install-extension",placeholder:"vendor/package-name",bidi:this.packageName}),m(l(),{className:"Button",icon:"fas fa-download",onclick:this.onsubmit.bind(this),loading:r().packageManager.control.isLoading("extension-install"),disabled:r().packageManager.control.isLoading()},r().translator.trans("flarum-package-manager.admin.extensions.proceed"))))},e.data=function(){return{package:this.packageName()}},e.onsubmit=function(){r().packageManager.control.requirePackage(this.data())},t}(b());const J=flarum.core.compat["common/helpers/humanTime"];var Z=e.n(J);function z(a){r().packageManager.control.setLoading(null);var t=a.response.errors[0];if(!["composer_command_failure","extension_already_installed","extension_not_installed"].includes(t.code))throw a;switch(r().alerts.clear(),t.code){case"composer_command_failure":t.guessed_cause?(r().alerts.show({type:"error"},r().translator.trans("flarum-package-manager.admin.exceptions.guessed_cause."+t.guessed_cause)),r().modal.close()):r().alerts.show({type:"error"},r().translator.trans("flarum-package-manager.admin.exceptions.composer_command_failure"));break;case"extension_already_installed":r().alerts.show({type:"error"},r().translator.trans("flarum-package-manager.admin.exceptions.extension_already_installed")),r().modal.close();break;case"extension_not_installed":r().alerts.show({type:"error"},r().translator.trans("flarum-package-manager.admin.exceptions.extension_not_installed")),r().modal.close()}}var Q=function(a){function t(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.call.apply(a,[this].concat(n))||this).loading=!0,t.whyNot=null,t}f(t,a);var e=t.prototype;return e.className=function(){return"Modal--large WhyNotModal"},e.title=function(){return r().translator.trans("flarum-package-manager.admin.why_not_modal.title")},e.oncreate=function(t){a.prototype.oncreate.call(this,t),this.requestWhyNot()},e.content=function(){return m("div",{className:"Modal-body"},this.loading?m(y(),null):m("pre",{className:"WhyNotModal-contents"},this.whyNot))},e.requestWhyNot=function(){var a=this;r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/package-manager/why-not",body:{data:{package:this.attrs.package}}}).then((function(t){a.loading=!1,a.whyNot=t.data.reason,m.redraw()})).catch(z)},t}(F());const K=flarum.core.compat["common/components/Dropdown"];var X=e.n(K),aa=function(a){function t(){return a.apply(this,arguments)||this}f(t,a);var e=t.prototype;return e.view=function(a){var t,e=this.attrs,n=e.extension,s=e.updates,o=e.onClickUpdate,i=e.whyNotWarning,c=e.isCore,u=e.isDanger,d=null!=(t=s["latest-minor"])?t:s["latest-major"]&&!c?s["latest-major"]:null;return m("div",{className:$()({"PackageManager-extension":!0,"PackageManager-extension--core":c,"PackageManager-extension--danger":u})},m("div",{className:"PackageManager-extension-icon ExtensionIcon",style:n.icon},n.icon?M()(n.icon.name):""),m("div",{className:"PackageManager-extension-info"},m("div",{className:"PackageManager-extension-name"},n.extra["flarum-extension"].title),m("div",{className:"PackageManager-extension-version"},m("span",{className:"PackageManager-extension-version-current"},this.version(s.version)),d?m(C,{className:"PackageManager-extension-version-latest",type:s["latest-minor"]?"success":"warning"},this.version(d)):null)),m("div",{className:"PackageManager-extension-controls"},o&&"function"==typeof o?m(N(),{text:r().translator.trans("flarum-package-manager.admin.extensions.update")},m(l(),{icon:"fas fa-arrow-alt-circle-up",className:"Button Button--icon Button--flat",onclick:o,"aria-label":r().translator.trans("flarum-package-manager.admin.extensions.update")})):o?m(X(),{buttonClassName:"Button Button--icon Button--flat",icon:"fas fa-arrow-alt-circle-up",label:r().translator.trans("flarum-package-manager.admin.extensions.update")},m(l(),{icon:"fas fa-arrow-alt-circle-up",className:"Button",onclick:o.soft},r().translator.trans("flarum-package-manager.admin.extensions.update_soft_label")),m(l(),{icon:"fas fa-arrow-alt-circle-up",className:"Button",onclick:o.hard,disabled:!s["direct-dependency"]},r().translator.trans("flarum-package-manager.admin.extensions.update_hard_label"))):null,i?m(N(),{text:r().translator.trans("flarum-package-manager.admin.extensions.check_why_it_failed_updating")},m(l(),{icon:"fas fa-exclamation-circle",className:"Button Button--icon Button--flat Button--danger",onclick:function(){return r().modal.show(Q,{package:n.name})},"aria-label":r().translator.trans("flarum-package-manager.admin.extensions.check_why_it_failed_updating")})):null))},e.version=function(a){return"v"===a.charAt(0)?a.substring(1):a},t}(b()),ta=function(a){function t(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.call.apply(a,[this].concat(n))||this).updateState=void 0,t}f(t,a);var e=t.prototype;return e.oninit=function(t){a.prototype.oninit.call(this,t),this.updateState=this.attrs.updateState},e.view=function(){return m("div",{className:$()("Form-group Form-group--danger PackageManager-majorUpdate",{"PackageManager-majorUpdate--failed":"failure"===this.updateState.status,"PackageManager-majorUpdate--incompatibleExtensions":this.updateState.incompatibleExtensions.length})},m("img",{alt:"flarum logo",src:r().forum.attribute("baseUrl")+"/assets/extensions/flarum-package-manager/flarum.svg"}),m("label",null,r().translator.trans("flarum-package-manager.admin.major_updater.title",{version:this.attrs.coreUpdate["latest-major"]})),m("p",{className:"helpText"},r().translator.trans("flarum-package-manager.admin.major_updater.description")),m("div",{className:"PackageManager-updaterControls"},m(N(),{text:r().translator.trans("flarum-package-manager.admin.major_updater.dry_run_help")},m(l(),{className:"Button",icon:"fas fa-vial",onclick:this.update.bind(this,!0),disabled:r().packageManager.control.isLoading()},r().translator.trans("flarum-package-manager.admin.major_updater.dry_run"))),m(l(),{className:"Button Button--danger",icon:"fas fa-play",onclick:this.update.bind(this,!1),disabled:r().packageManager.control.isLoading()},r().translator.trans("flarum-package-manager.admin.major_updater.update"))),this.updateState.incompatibleExtensions.length?m("div",{className:"PackageManager-majorUpdate-incompatibleExtensions PackageManager-extensions-grid"},this.updateState.incompatibleExtensions.map((function(a){return m(aa,{extension:r().data.extensions[a.replace("flarum-","").replace("flarum-ext-","").replace("/","-")],updates:{},onClickUpdate:null,isDanger:!0})}))):null,"failure"===this.updateState.status?m(H(),{type:"error",className:"PackageManager-majorUpdate-failure",dismissible:!1,controls:[m(l(),{className:"Button Button--text PackageManager-majorUpdate-failure-details",icon:"fas fa-question-circle",onclick:function(){return r().modal.show(Q,{package:"flarum/core"})}},r().translator.trans("flarum-package-manager.admin.major_updater.failure.why"))]},m("p",{className:"PackageManager-majorUpdate-failure-desc"},r().translator.trans("flarum-package-manager.admin.major_updater.failure.desc"))):null)},e.update=function(a){r().packageManager.control.majorUpdate({dryRun:a})},t}(b()),ea=function(a){function t(){return a.apply(this,arguments)||this}f(t,a);var e=t.prototype;return e.view=function(){var a=r().packageManager.control.coreUpdate;return[m("div",{className:"Form-group"},m("label",null,r().translator.trans("flarum-package-manager.admin.updater.updater_title")),m("p",{className:"helpText"},r().translator.trans("flarum-package-manager.admin.updater.updater_help")),this.lastUpdateCheckView(),m("div",{className:"PackageManager-updaterControls"},this.controlItems().toArray()),this.availableUpdatesView()),a&&a.package["latest-major"]?m(ta,{coreUpdate:a.package,updateState:r().packageManager.control.lastUpdateRun.major}):null]},e.lastUpdateCheckView=function(){var a;return(null==(a=r().packageManager.control.lastUpdateCheck)?void 0:a.checkedAt)&&m("p",{className:"PackageManager-lastUpdatedAt"},m("span",{className:"PackageManager-lastUpdatedAt-label"},r().translator.trans("flarum-package-manager.admin.updater.last_update_checked_at")),m("span",{className:"PackageManager-lastUpdatedAt-value"},Z()(r().packageManager.control.lastUpdateCheck.checkedAt)))||null},e.availableUpdatesView=function(){var a=r().packageManager.control;if(r().packageManager.control.isLoading("check")||r().packageManager.control.isLoading("global-update"))return m("div",{className:"PackageManager-extensions"},m(y(),null));var t=a.coreUpdate&&a.coreUpdate.package["latest-minor"];return a.extensionUpdates.length||t?m("div",{className:"PackageManager-extensions"},m("div",{className:"PackageManager-extensions-grid"},t?m(aa,{extension:a.coreUpdate.extension,updates:a.coreUpdate.package,isCore:!0,onClickUpdate:function(){return a.updateCoreMinor()},whyNotWarning:a.lastUpdateRun.limitedPackages().includes("flarum/core")}):null,a.extensionUpdates.map((function(t){return m(aa,{extension:t,updates:a.packageUpdates[t.id],onClickUpdate:{soft:function(){return a.updateExtension(t,"soft")},hard:function(){return a.updateExtension(t,"hard")}},whyNotWarning:a.lastUpdateRun.limitedPackages().includes(t.name)})})))):m("div",{className:"PackageManager-extensions"},m("span",{className:"helpText"},r().translator.trans("flarum-package-manager.admin.updater.up_to_date")))},e.controlItems=function(){var a=new(P());return a.add("updateCheck",m(l(),{className:"Button",icon:"fas fa-sync-alt",onclick:function(){return r().packageManager.control.checkForUpdates()},loading:r().packageManager.control.isLoading("check"),disabled:r().packageManager.control.isLoading()},r().translator.trans("flarum-package-manager.admin.updater.check_for_updates")),100),a.add("globalUpdate",m(l(),{className:"Button",icon:"fas fa-play",onclick:function(){return r().packageManager.control.updateGlobally()},loading:r().packageManager.control.isLoading("global-update"),disabled:r().packageManager.control.isLoading()},r().translator.trans("flarum-package-manager.admin.updater.run_global_update"))),a},t}(b()),na=function(a){function t(){return a.apply(this,arguments)||this}f(t,a);var e=t.prototype;return e.oninit=function(t){a.prototype.oninit.call(this,t)},e.view=function(){return m("div",{className:"ExtensionPage-permissions PackageManager-controlSection"},m("div",{className:"ExtensionPage-permissions-header"},m("div",{className:"container"},m("h2",{className:"ExtensionTitle"},r().translator.trans("flarum-package-manager.admin.sections.control.title")))),m("div",{className:"container"},r().data["flarum-package-manager.writable_dirs"]?m("[",null,m(V,null),m(ea,null)):m("div",{className:"Form-group"},m(H(),{type:"warning",dismissible:!1},r().translator.trans("flarum-package-manager.admin.file_permissions")))))},t}(b());function ra(){return ra=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n])}return a},ra.apply(this,arguments)}const sa=flarum.core.compat["admin/components/AdminPage"];var oa=e.n(sa),ia=function(a){function t(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.call.apply(a,[this].concat(n))||this).settings={},t.initialSettings=null,t.loading=!1,t.type=void 0,t}f(t,a);var e=t.prototype;return e.oninit=function(t){a.prototype.oninit.call(this,t),this.submit(!0)},e.className=function(){return""},e.view=function(){return m("div",{className:$()("Form",this.className())},m("label",null,this.title()),this.content(),m("div",{className:"Form-group Form--controls"},this.submitButton()))},e.submitButton=function(){var a=this;return[m(l(),{className:"Button Button--primary",loading:this.loading,onclick:function(){return a.submit(!1)},disabled:!this.isDirty()},r().translator.trans("core.admin.settings.submit_button"))]},e.customSettingComponents=function(){return oa().prototype.customSettingComponents()},e.setting=function(a){var t;return null!=(t=this.settings[a])?t:this.settings[a]=R()()},e.submit=function(a){var t=this;this.loading=!0;var e={};Object.keys(this.settings).forEach((function(a){e[a]=t.settings[a]()})),r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/package-manager/composer",body:{type:this.type,data:a?null:e}}).then((function(a){var e=a.data;Object.keys(e).forEach((function(a){t.settings[a]=R()(e[a])})),t.initialSettings=Array.isArray(e)?{}:e})).finally((function(){t.loading=!1,m.redraw()}))},e.isDirty=function(){return JSON.stringify(this.initialSettings)!==JSON.stringify(this.settings)},t}(b());const la=flarum.core.compat["common/components/Select"];var ca=e.n(la),ua=function(a){function t(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.call.apply(a,[this].concat(n))||this).name=void 0,t.repository=void 0,t}f(t,a);var e=t.prototype;return e.oninit=function(t){a.prototype.oninit.call(this,t),this.name=R()(this.attrs.name||""),this.repository=R()(this.attrs.repository||{type:"composer",url:""})},e.className=function(){return"RepositoryModal Modal--small"},e.title=function(){var a=this.attrs.repository?"edit":"add";return r().translator.trans("flarum-package-manager.admin.composer."+a+"_repository_label")},e.content=function(){var a=this,t={composer:r().translator.trans("flarum-package-manager.admin.composer.repositories.types.composer"),vcs:r().translator.trans("flarum-package-manager.admin.composer.repositories.types.vcs"),path:r().translator.trans("flarum-package-manager.admin.composer.repositories.types.path")};return m("div",{className:"Modal-body"},m("div",{className:"Form-group"},m("label",null,r().translator.trans("flarum-package-manager.admin.composer.repositories.add_modal.name_label")),m("input",{className:"FormControl",bidi:this.name})),m("div",{className:"Form-group"},m("label",null,r().translator.trans("flarum-package-manager.admin.composer.repositories.add_modal.type_label")),m(ca(),{options:t,value:this.repository().type,onchange:function(t){return a.repository(ra({},a.repository(),{type:t}))}})),m("div",{className:"Form-group"},m("label",null,r().translator.trans("flarum-package-manager.admin.composer.repositories.add_modal.url")),m("input",{className:"FormControl",onchange:function(t){return a.repository(ra({},a.repository(),{url:t.target.value}))},value:this.repository().url})),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",onclick:this.submit.bind(this)},r().translator.trans("flarum-package-manager.admin.composer.repositories.add_modal.submit_button"))))},e.submit=function(){this.attrs.onsubmit(this.repository(),this.name()),this.hide()},t}(F()),ma=function(a){function t(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.call.apply(a,[this].concat(n))||this).type="composer",t}f(t,a);var e=t.prototype;return e.title=function(){return r().translator.trans("flarum-package-manager.admin.composer.title")},e.className=function(){return"ConfigureComposer"},e.content=function(){var a=this;return m("div",{className:"SettingsGroups-content"},this.attrs.buildSettingComponent.call(this,{setting:"minimum-stability",label:r().translator.trans("flarum-package-manager.admin.composer.minimum_stability.label"),help:r().translator.trans("flarum-package-manager.admin.composer.minimum_stability.help"),type:"select",options:{stable:r().translator.trans("flarum-package-manager.admin.composer.minimum_stability.options.stable"),RC:r().translator.trans("flarum-package-manager.admin.composer.minimum_stability.options.rc"),beta:r().translator.trans("flarum-package-manager.admin.composer.minimum_stability.options.beta"),alpha:r().translator.trans("flarum-package-manager.admin.composer.minimum_stability.options.alpha"),dev:r().translator.trans("flarum-package-manager.admin.composer.minimum_stability.options.dev")}}),m("div",{className:"Form-group"},m("label",null,r().translator.trans("flarum-package-manager.admin.composer.repositories.label")),m("div",{className:"helpText"},r().translator.trans("flarum-package-manager.admin.composer.repositories.help")),m("div",{className:"ConfigureComposer-repositories"},Object.keys(this.setting("repositories")()||{}).map((function(t){var e=a.setting("repositories")()[t];return m("div",{className:"ButtonGroup ButtonGroup--full"},m(l(),{className:"Button",icon:{composer:"fas fa-cubes",vcs:"fas fa-code-branch",path:"fas fa-folder"}[e.type],onclick:function(){return r().modal.show(ua,{name:t,repository:e,onsubmit:function(e,n){var r=a.setting("repositories")();delete r[t],a.setting("repositories")(r),a.onchange(e,n)}})}},t," (",e.type,")"),m(l(),{className:"Button Button--icon",icon:"fas fa-trash","aria-label":r().translator.trans("flarum-package-manager.admin.composer.delete_repository_label"),onclick:function(){if(confirm(B()(r().translator.trans("flarum-package-manager.admin.composer.delete_repository_confirmation")))){var e=ra({},a.setting("repositories")());delete e[t],a.setting("repositories")(e)}}}))})))))},e.submitButton=function(){var t=this,e=a.prototype.submitButton.call(this);return e.push(m(l(),{className:"Button",onclick:function(){return r().modal.show(ua,{onsubmit:t.onchange.bind(t)})}},r().translator.trans("flarum-package-manager.admin.composer.add_repository_label"))),e},e.onchange=function(a,t){var e;this.setting("repositories")(ra({},this.setting("repositories")(),((e={})[t]=a,e)))},t}(ia);const da=flarum.core.compat["common/helpers/listItems"];var pa=e.n(da),ga=function(a){function t(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.call.apply(a,[this].concat(n))||this).type=void 0,t.host=void 0,t.token=void 0,t}f(t,a);var e=t.prototype;return e.oninit=function(t){a.prototype.oninit.call(this,t),this.type=R()(this.attrs.type||"bearer"),this.host=R()(this.attrs.host||""),this.token=R()(this.attrs.token||"")},e.className=function(){return"AuthMethodModal Modal--small"},e.title=function(){var a=this.attrs.host?"edit":"add";return r().translator.trans("flarum-package-manager.admin.auth_config."+a+"_label")},e.content=function(){var a=this,t={"github-oauth":r().translator.trans("flarum-package-manager.admin.auth_config.types.github-oauth"),"gitlab-oauth":r().translator.trans("flarum-package-manager.admin.auth_config.types.gitlab-oauth"),"gitlab-token":r().translator.trans("flarum-package-manager.admin.auth_config.types.gitlab-token"),bearer:r().translator.trans("flarum-package-manager.admin.auth_config.types.bearer")};return m("div",{className:"Modal-body"},m("div",{className:"Form-group"},m("label",null,r().translator.trans("flarum-package-manager.admin.auth_config.add_modal.type_label")),m(ca(),{options:t,value:this.type(),onchange:this.type})),m("div",{className:"Form-group"},m("label",null,r().translator.trans("flarum-package-manager.admin.auth_config.add_modal.host_label")),m("input",{className:"FormControl",bidi:this.host,placeholder:r().translator.trans("flarum-package-manager.admin.auth_config.add_modal.host_placeholder")})),m("div",{className:"Form-group"},m("label",null,r().translator.trans("flarum-package-manager.admin.auth_config.add_modal.token_label")),m("textarea",{className:"FormControl",oninput:function(t){return a.token(t.target.value)},rows:"6",placeholder:this.token().startsWith("unchanged:")?B()(r().translator.trans("flarum-package-manager.admin.auth_config.add_modal.unchanged_token_placeholder")):""},this.token().startsWith("unchanged:")?"":this.token())),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary",onclick:this.submit.bind(this)},r().translator.trans("flarum-package-manager.admin.auth_config.add_modal.submit_button"))))},e.submit=function(){this.attrs.onsubmit(this.type(),this.host(),this.token()),this.hide()},t}(F()),fa=function(a){function t(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.call.apply(a,[this].concat(n))||this).type="auth",t}f(t,a);var e=t.prototype;return e.title=function(){return r().translator.trans("flarum-package-manager.admin.auth_config.title")},e.className=function(){return"ConfigureAuth"},e.content=function(){var a=this,t=Object.keys(this.settings),e=t.length&&t.every((function(t){var e=a.settings[t]();return Array.isArray(e)?e.length:Object.keys(e).length}));return m("div",{className:"SettingsGroups-content"},e?t.map((function(t){var e=a.settings[t]();return m("div",{className:"Form-group"},m("label",null,r().translator.trans("flarum-package-manager.admin.auth_config.types."+t)),m("div",{className:"ConfigureAuth-hosts"},Object.keys(e).map((function(n){var s=e[n];return m("div",{className:"ButtonGroup ButtonGroup--full"},m(l(),{className:"Button",icon:"fas fa-key",onclick:function(){return r().modal.show(ga,{type:t,host:n,token:s,onsubmit:a.onchange.bind(a,n)})}},n),m(l(),{className:"Button Button--icon",icon:"fas fa-trash","aria-label":r().translator.trans("flarum-package-manager.admin.auth_config.delete_label"),onclick:function(){if(confirm(B()(r().translator.trans("flarum-package-manager.admin.auth_config.delete_confirmation")))){var e=ra({},a.setting(t)());delete e[n],Object.keys(e).length?a.setting(t)(e):delete a.settings[t]}}}))}))))})):m("span",{className:"helpText"},r().translator.trans("flarum-package-manager.admin.auth_config.no_auth_methods_configured")))},e.submitButton=function(){var t=this,e=a.prototype.submitButton.call(this);return e.push(m(l(),{className:"Button",loading:this.loading,onclick:function(){return r().modal.show(ga,{onsubmit:t.onchange.bind(t,null)})}},r().translator.trans("flarum-package-manager.admin.auth_config.add_label"))),e},e.onchange=function(a,t,e,n){var r=ra({},this.setting(t)());a&&delete r[a],r[e]=n,this.setting(t)(r)},t}(ia),ha=function(a){function t(){return a.apply(this,arguments)||this}f(t,a);var e=t.prototype;return e.content=function(){var a=r().extensionData.getSettings(this.extension.id),t=[r().translator.trans("flarum-package-manager.admin.settings.access_warning")];return r().data.debugEnabled&&t.push(r().translator.trans("flarum-package-manager.admin.settings.debug_mode_warning")),m("div",{className:"ExtensionPage-settings"},m("div",{className:"container"},m("div",{className:"Form-group"},m(H(),{className:"PackageManager-primaryWarning",type:"warning",dismissible:!1},m("ul",null,pa()(t)))),a?m("div",{className:"SettingsGroups"},m("div",{className:"Form"},m("label",null,r().translator.trans("flarum-package-manager.admin.settings.title")),m("div",{className:"SettingsGroups-content"},a.map(this.buildSettingComponent.bind(this))),m("div",{className:"Form-group Form--controls"},this.submitButton())),m(ma,{buildSettingComponent:this.buildSettingComponent}),m(fa,{buildSettingComponent:this.buildSettingComponent})):m("h3",{className:"ExtensionPage-subHeader"},r().translator.trans("core.admin.extension.no_settings"))))},e.sections=function(t){var e=a.prototype.sections.call(this,t);return e.setPriority("content",10),e.add("control",m(na,null),8),"0"!==r().data.settings["flarum-package-manager.queue_jobs"]&&r().data.settings["flarum-package-manager.queue_jobs"]&&e.add("queue",m(I,null),5),e.remove("permissions"),e},e.onsaved=function(){a.prototype.onsaved.call(this),m.redraw()},t}(o());const ka=flarum.core.compat["common/Model"];var ba=e.n(ka),va=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],ya=["B","kiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],_a=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],Na=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],xa=function(a,t,e){var n=a;return"string"==typeof t||Array.isArray(t)?n=a.toLocaleString(t,e):!0!==t&&void 0===e||(n=a.toLocaleString(void 0,e)),n},Ma=function(a){function t(){return a.apply(this,arguments)||this}f(t,a);var e=t.prototype;return e.status=function(){return ba().attribute("status").call(this)},e.operation=function(){return ba().attribute("operation").call(this)},e.command=function(){return ba().attribute("command").call(this)},e.package=function(){return ba().attribute("package").call(this)},e.output=function(){return ba().attribute("output").call(this)},e.guessedCause=function(){return ba().attribute("guessedCause").call(this)},e.createdAt=function(){return ba().attribute("createdAt",ba().transformDate).call(this)},e.startedAt=function(){return ba().attribute("startedAt",ba().transformDate).call(this)},e.finishedAt=function(){return ba().attribute("finishedAt",ba().transformDate).call(this)},e.peakMemoryUsed=function(){return function(a,t){if(!Number.isFinite(a))throw new TypeError("Expected a finite number, got "+typeof a+": "+a);var e=(t=ra({bits:!1,binary:!1},t)).bits?t.binary?Na:_a:t.binary?ya:va;if(t.signed&&0===a)return" 0 "+e[0];var n,r=a<0,s=r?"-":t.signed?"+":"";if(r&&(a=-a),void 0!==t.minimumFractionDigits&&(n={minimumFractionDigits:t.minimumFractionDigits}),void 0!==t.maximumFractionDigits&&(n=ra({maximumFractionDigits:t.maximumFractionDigits},n)),a<1)return s+xa(a,t.locale,n)+" "+e[0];var o=Math.min(Math.floor(t.binary?Math.log(a)/Math.log(1024):Math.log10(a)/3),e.length-1);return a/=Math.pow(t.binary?1024:1e3,o),n||(a=a.toPrecision(3)),s+xa(Number(a),t.locale,n)+" "+e[o]}(1024*ba().attribute("peakMemoryUsed").call(this))},t}(ba());function wa(){r().modal.close(),m.route.set(r().route("extension",{id:"flarum-package-manager"})),r().packageManager.queue.load({},!0),setTimeout((function(){var a;null==(a=document.getElementById("PackageManager-queueSection"))||a.scrollIntoView({block:"nearest"})}),200)}window.jumpToQueue=wa;var Pa=function(){function a(){this.polling=null,this.tasks=null,this.limit=20,this.offset=0,this.total=0}var t=a.prototype;return t.load=function(a,t){var e,n=this;return void 0===t&&(t=!1),this.tasks=null,a=ra({page:ra({limit:this.limit,offset:this.offset},null==(e=a)?void 0:e.page)},a),r().store.find("package-manager-tasks",a||{}).then((function(a){var e;return n.tasks=a,n.total=null==(e=a.payload.meta)?void 0:e.total,m.redraw(),(null==a?void 0:a.find((function(a){return"pending"===a.status()||"running"===a.status()})))?n.pollQueue(t):t?(r().packageManager.control.setLoading(null),window.location.reload()):r().packageManager.control.isLoading()&&r().packageManager.control.setLoading(null),a}))},t.getItems=function(){return this.tasks},t.getTotalPages=function(){return Math.ceil(this.total/this.limit)},t.pageNumber=function(){return Math.ceil(this.offset/this.limit)},t.hasPrev=function(){return 0!==this.pageNumber()},t.hasNext=function(){return this.offset+this.limit<this.total},t.prev=function(){this.hasPrev()&&(this.offset-=this.limit,this.load())},t.next=function(){this.hasNext()&&(this.offset+=this.limit,this.load())},t.pollQueue=function(a){var t=this;void 0===a&&(a=!1),this.polling&&clearTimeout(this.polling),this.polling=setTimeout((function(){t.load({},a)}),6e3)},a}();function Ua(a,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}var Ba=function(){function a(){this.loading=null,this.packageUpdates={},this.lastUpdateCheck=void 0,this.extensionUpdates=void 0,this.coreUpdate=null,this.lastUpdateCheck=JSON.parse(r().data.settings["flarum-package-manager.last_update_check"]),this.extensionUpdates=this.formatExtensionUpdates(this.lastUpdateCheck),this.coreUpdate=this.formatCoreUpdate(this.lastUpdateCheck)}var t,e,n=a.prototype;return n.isLoading=function(a){return void 0===a&&(a=null),a&&this.loading===a||!a&&null!==this.loading},n.setLoading=function(a){this.loading=a},n.requirePackage=function(a){r().packageManager.control.setLoading("extension-install"),r().modal.show(u()),r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/package-manager/extensions",body:{data:a}}).then((function(a){if(a.processing)wa();else{var t=a.id;r().alerts.show({type:"success"},r().translator.trans("flarum-package-manager.admin.extensions.successful_install",{extension:t})),window.location.href=r().forum.attribute("adminUrl")+"#/extension/"+t,window.location.reload()}})).catch(z).finally((function(){r().modal.close(),m.redraw()}))},n.checkForUpdates=function(){var a=this;this.setLoading("check"),r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/package-manager/check-for-updates"}).then((function(t){t.processing?wa():(a.lastUpdateCheck=t,a.extensionUpdates=a.formatExtensionUpdates(t),a.coreUpdate=a.formatCoreUpdate(t),a.setLoading(null),m.redraw())})).catch(z).finally((function(){m.redraw()}))},n.updateCoreMinor=function(){confirm(B()(r().translator.trans("flarum-package-manager.admin.minor_update_confirmation.content")))&&(r().modal.show(u()),this.setLoading("minor-update"),r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/package-manager/minor-update"}).then((function(a){null!=a&&a.processing?wa():(r().alerts.show({type:"success"},r().translator.trans("flarum-package-manager.admin.update_successful")),window.location.reload())})).catch(z).finally((function(){r().modal.close(),m.redraw()})))},n.updateExtension=function(a,t){r().modal.show(u()),this.setLoading("extension-update"),r().request({method:"PATCH",url:r().forum.attribute("apiUrl")+"/package-manager/extensions/"+a.id,body:{data:{updateMode:t}}}).then((function(t){null!=t&&t.processing?wa():(r().alerts.show({type:"success"},r().translator.trans("flarum-package-manager.admin.extensions.successful_update",{extension:a.extra["flarum-extension"].title})),window.location.reload())})).catch(z).finally((function(){r().modal.close(),m.redraw()}))},n.updateGlobally=function(){r().modal.show(u()),this.setLoading("global-update"),r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/package-manager/global-update"}).then((function(a){null!=a&&a.processing?wa():(r().alerts.show({type:"success"},r().translator.trans("flarum-package-manager.admin.updater.global_update_successful")),window.location.reload())})).catch(z).finally((function(){r().modal.close(),m.redraw()}))},n.formatExtensionUpdates=function(a){var t,e,n=this;return this.packageUpdates={},null==a||null==(t=a.updates)||null==(e=t.installed)||e.filter((function(a){var t=a.name.replace("/","-").replace(/(flarum-ext-)|(flarum-)/,""),e=r().data.extensions[t],s=["semver-safe-update","update-possible"].includes(a["latest-status"]);return e&&s&&(n.packageUpdates[e.id]=a),e&&s})),Object.values(r().data.extensions).filter((function(a){return n.packageUpdates[a.id]}))},n.formatCoreUpdate=function(a){var t,e,n=null==a||null==(t=a.updates)||null==(e=t.installed)?void 0:e.filter((function(a){return"flarum/core"===a.name})).pop();return n?{package:n,extension:{id:"flarum-core",name:"flarum/core",version:r().data.settings.version,icon:{backgroundImage:"url("+r().data.resources[0].attributes.baseUrl+"/assets/extensions/flarum-package-manager/flarum.svg"},extra:{"flarum-extension":{title:B()(r().translator.trans("flarum-package-manager.admin.updater.flarum"))}}}}:null},n.majorUpdate=function(a){var t=a.dryRun;r().packageManager.control.setLoading(t?"major-update-dry-run":"major-update"),r().modal.show(u());var e=this.lastUpdateRun.major;r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/package-manager/major-update",body:{data:{dryRun:t}}}).then((function(a){null!=a&&a.processing?wa():(r().alerts.show({type:"success"},r().translator.trans("flarum-package-manager.admin.update_successful")),window.location.reload())})).catch(z).catch((function(a){var t,n,s;r().modal.close(),e.status="failure",e.incompatibleExtensions=null==(t=a.response)||null==(n=t.errors)||null==(s=n.pop())?void 0:s.incompatible_extensions})).finally((function(){m.redraw()}))},t=a,(e=[{key:"lastUpdateRun",get:function(){var a=JSON.parse(r().data.settings["flarum-package-manager.last_update_run"]);return a.limitedPackages=function(){return[].concat(a.major.limitedPackages,a.minor.limitedPackages,a.global.limitedPackages)},a}}])&&Ua(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),a}(),Sa=function(){this.queue=new Pa,this.control=new Ba};r().initializers.add("flarum-package-manager",(function(t){t.store.models["package-manager-tasks"]=Ma,t.packageManager=new Sa,t.data["flarum-package-manager.using_sync_queue"]&&(t.data.settings["flarum-package-manager.queue_jobs"]="0"),t.extensionData.for("flarum-package-manager").registerSetting({setting:"flarum-package-manager.queue_jobs",label:t.translator.trans("flarum-package-manager.admin.settings.queue_jobs"),help:m.trust(B()(t.translator.trans("flarum-package-manager.admin.settings.queue_jobs_help",{basic_impl_link:"https://discuss.flarum.org/d/28151-database-queue-the-simplest-queue-even-for-shared-hosting",adv_impl_link:"https://discuss.flarum.org/d/21873-redis-sessions-cache-queues",php_version:"<strong>"+t.data.phpVersion+"</strong>",folder_perms_link:"https://docs.flarum.org/install#folder-ownership"}))),type:"boolean",disabled:t.data["flarum-package-manager.using_sync_queue"]}).registerSetting({setting:"flarum-package-manager.task_retention_days",label:t.translator.trans("flarum-package-manager.admin.settings.task_retention_days"),help:t.translator.trans("flarum-package-manager.admin.settings.task_retention_days_help"),type:"number"}).registerPage(ha),(0,a.extend)(o().prototype,"topItems",(function(a){var e=this;"flarum-package-manager"===this.extension.id||p()(this.extension.id)||a.add("remove",m(l(),{className:"Button Button--danger",icon:"fas fa-times",onclick:function(){t.modal.show(u()),t.request({url:t.forum.attribute("apiUrl")+"/package-manager/extensions/"+e.extension.id,method:"DELETE"}).then((function(a){null!=a&&a.processing?wa():(t.alerts.show({type:"success"},t.translator.trans("flarum-package-manager.admin.extensions.successful_remove")),window.location=t.forum.attribute("adminUrl"))})).finally((function(){t.modal.close()}))}},t.translator.trans("flarum-package-manager.admin.extensions.remove")))}))}))})(),module.exports=n})();
//# sourceMappingURL=admin.js.map